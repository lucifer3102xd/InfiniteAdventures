(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='WolframDesktop 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       161,          7]
NotebookDataLength[     15980,        308]
NotebookOptionsPosition[     15454,        291]
NotebookOutlinePosition[     15840,        308]
CellTagsIndexPosition[     15797,        305]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"lm", "=", 
   RowBox[{"NetModel", "[", 
    RowBox[{"{", 
     RowBox[{"\"\<GPT-2 Transformer Trained on WebText Data\>\"", ",", 
      RowBox[{"\"\<Task\>\"", "\[Rule]", "\"\<LanguageModeling\>\""}]}], 
     "}"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"generateSample", "[", "languagemodel_", "]"}], "[", 
    RowBox[{"input_String", ",", 
     RowBox[{"numTokens_:", " ", "300"}], ",", 
     RowBox[{"temperature_:", " ", "0.75"}]}], "]"}], ":=", 
   RowBox[{"Nest", "[", 
    RowBox[{
     RowBox[{"Function", "[", 
      RowBox[{"StringJoin", "[", 
       RowBox[{"#", ",", 
        RowBox[{"languagemodel", "[", 
         RowBox[{"#", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<RandomSample\>\"", ",", 
            RowBox[{"\"\<Temperature\>\"", "\[Rule]", "temperature"}]}], 
           "}"}], ",", 
          RowBox[{"TargetDevice", "\[Rule]", "\"\<GPU\>\""}]}], "]"}]}], 
       "]"}], "]"}], ",", "input", ",", "numTokens"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.7853194737042694`*^9, 3.7853194737052703`*^9}, {
  3.7853201090512667`*^9, 3.7853201203085175`*^9}, {3.7853202052519426`*^9, 
  3.7853202084948993`*^9}, {3.785321455605212*^9, 3.785321457045519*^9}, {
  3.7853215718471937`*^9, 3.7853215982933073`*^9}, {3.785321665795857*^9, 
  3.78532173926886*^9}, {3.785322077979512*^9, 3.7853222206836314`*^9}, {
  3.7853226104410267`*^9, 3.785322639239294*^9}, {3.7853326528628654`*^9, 
  3.7853326552840633`*^9}, {3.7853420918053417`*^9, 3.7853421061143885`*^9}, {
  3.7853488135830536`*^9, 3.78534881647971*^9}, {3.7853505791417847`*^9, 
  3.785350636890175*^9}, {3.7853506734642324`*^9, 3.7853506744067936`*^9}, {
  3.7853515320634356`*^9, 3.785351533343602*^9}, {3.7853627927685037`*^9, 
  3.785362793336007*^9}, {3.7854193339868407`*^9, 3.7854193341730022`*^9}},
 CellLabel->"In[18]:=",ExpressionUUID->"2d8c86ab-de9a-468f-bffa-b291648a3f0b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"string", "=", "\"\<\>\""}], ";", 
  RowBox[{"wholestory", "=", 
   RowBox[{"{", "}"}]}], ";", 
  RowBox[{"story", "=", 
   RowBox[{"AskFunction", "[", 
    RowBox[{
     RowBox[{
     "AskDisplay", "[", 
      "\"\<Infinite Interactive Story Generator. Game ends when a story of \
3000 characters is generated.\>\"", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Ask", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\"\<name\>\"", ",", "\"\<Name your protagonist\>\""}], "}"}],
        "\[Rule]", "\"\<String\>\""}], "]"}], ";", 
     RowBox[{"Ask", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "\"\<nameOfLand\>\"", ",", "\"\<Where is your character from?\>\""}], 
        "}"}], "\[Rule]", "\"\<String\>\""}], "]"}], ";", 
     RowBox[{"Ask", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "\"\<profession\>\"", ",", 
         "\"\<What does your protagonist do for a living?\>\""}], "}"}], 
       "\[Rule]", "\"\<String\>\""}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Ask", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "\"\<mission\>\"", ",", "\"\<What is your character's mission?\>\""}],
         "}"}], "\[Rule]", "\"\<String\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"string", "=", 
      RowBox[{"\"\<Your name is \>\"", "<>", 
       RowBox[{"AskedValue", "[", "\"\<name\>\"", "]"}], "<>", 
       "\"\<. You are a \>\"", "<>", 
       RowBox[{"AskedValue", "[", "\"\<profession\>\"", "]"}], "<>", 
       "\"\< in the land of \>\"", "<>", 
       RowBox[{"AskedValue", "[", "\"\<nameOfLand\>\"", "]"}], "<>", 
       "\"\<. \>\"", "<>", "\"\< The mission of \>\"", "<>", 
       RowBox[{"AskedValue", "[", "\"\<name\>\"", "]"}], "<>", 
       "\"\< is to \>\"", "<>", 
       RowBox[{"AskedValue", "[", "\"\<mission\>\"", "]"}], "<>", 
       "\"\<.\>\""}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"AppendTo", "[", 
      RowBox[{"wholestory", ",", 
       RowBox[{"TextSentences", "[", "string", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"wholestory", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"wholestory", ",", "10"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"StringLength", "[", 
         RowBox[{"StringRiffle", "[", 
          RowBox[{"TextSentences", "[", "wholestory", "]"}], "]"}], "]"}], 
        "\[LessEqual]", "3000"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"string", "=", 
         RowBox[{"StringRiffle", "[", 
          RowBox[{
           RowBox[{"DeleteDuplicates", "[", 
            RowBox[{"TextSentences", "[", 
             RowBox[{
              RowBox[{"generateSample", "[", "lm", "]"}], "[", 
              RowBox[{
               RowBox[{"StringRiffle", "[", 
                RowBox[{"DeleteDuplicates", "[", 
                 RowBox[{"Flatten", "[", "wholestory", "]"}], "]"}], "]"}], 
               ",", "30"}], "]"}], "]"}], "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"All", ";;", 
             RowBox[{"-", "2"}]}], "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"wholestory", "=", 
         RowBox[{"DeleteDuplicates", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"TextSentences", "[", "string", "]"}], ",", "10"}], "]"}],
           "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"temp", "=", 
         RowBox[{"PrintTemporary", "[", 
          RowBox[{"StringRiffle", "[", 
           RowBox[{"DeleteDuplicates", "[", 
            RowBox[{"Flatten", "[", "wholestory", "]"}], "]"}], "]"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Ask", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "\"\<response\>\"", ",", "\"\<What is your response?\>\""}], "}"}],
           "\[Rule]", "\"\<String\>\""}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"NotebookDelete", "[", "temp", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"wholestory", ",", 
          RowBox[{"TextSentences", "[", 
           RowBox[{"AskedValue", "[", "\"\<response\>\"", "]"}], "]"}]}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"wholestory", "=", 
         RowBox[{"DeleteDuplicates", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{"wholestory", ",", "10"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Ask", "[", "\"\<response\>\"", "]"}], "=."}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"NotebookDelete", "[", "temp", "]"}], ";", 
        RowBox[{"Print", "[", "\"\<\>\"", "]"}]}]}], "\[IndentingNewLine]", 
      "]"}], ";"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7853228694321985`*^9, 3.785322869908646*^9}, {
   3.7853229026835394`*^9, 3.78532293323167*^9}, {3.7853229886691976`*^9, 
   3.7853230147730007`*^9}, {3.785323114209676*^9, 3.785323269692436*^9}, 
   3.7853233102824564`*^9, {3.785323383694392*^9, 3.7853234679342422`*^9}, {
   3.7853235276276784`*^9, 3.785323546906248*^9}, {3.7853236140965033`*^9, 
   3.785323635953019*^9}, {3.785323694315243*^9, 3.785323711347765*^9}, {
   3.7853237924687223`*^9, 3.7853238129674234`*^9}, {3.78532389859549*^9, 
   3.7853239111469345`*^9}, {3.7853239692979665`*^9, 
   3.7853241718218417`*^9}, {3.7853243162127104`*^9, 
   3.7853243180223804`*^9}, {3.7853244085249004`*^9, 3.785324465303268*^9}, {
   3.7853245166731167`*^9, 3.7853245201522803`*^9}, {3.785324570076823*^9, 
   3.785324585667039*^9}, 3.7853246578478537`*^9, {3.7853247246287565`*^9, 
   3.785324731603115*^9}, {3.785324781378492*^9, 3.7853247823594046`*^9}, {
   3.785324860170352*^9, 3.7853248775481796`*^9}, {3.7853249798454604`*^9, 
   3.7853249933457885`*^9}, {3.7853250236674786`*^9, 3.7853250689768*^9}, 
   3.785325113609576*^9, {3.7853252344127293`*^9, 3.7853252538174477`*^9}, {
   3.785325369698122*^9, 3.7853254310578012`*^9}, {3.785325647791467*^9, 
   3.7853256642855196`*^9}, {3.7853257755339565`*^9, 
   3.7853258565784225`*^9}, {3.7853259665538917`*^9, 
   3.7853260021593485`*^9}, {3.7853260498278217`*^9, 3.785326049892881*^9}, {
   3.7853260893948903`*^9, 3.785326107789254*^9}, {3.7853261574885545`*^9, 
   3.7853261755670576`*^9}, {3.785326205604427*^9, 3.7853262784964623`*^9}, {
   3.785326332847006*^9, 3.785326403134314*^9}, {3.785326599158189*^9, 
   3.785326600663562*^9}, {3.7853267097200003`*^9, 3.7853267098151045`*^9}, {
   3.785326742339328*^9, 3.785326799354744*^9}, 3.785326932027683*^9, {
   3.7853270615657854`*^9, 3.7853271027022996`*^9}, {3.7853271409721794`*^9, 
   3.7853271888718553`*^9}, {3.785327249018707*^9, 3.78532725030387*^9}, {
   3.7853273671654263`*^9, 3.7853273792684703`*^9}, {3.785327491724008*^9, 
   3.7853275198766685`*^9}, 3.785327623072773*^9, {3.785327686889962*^9, 
   3.7853276953777018`*^9}, {3.7853278117968445`*^9, 3.785327813422336*^9}, {
   3.785328066655244*^9, 3.785328125065322*^9}, 3.785328165261718*^9, {
   3.7853282204641933`*^9, 3.7853282485177946`*^9}, 3.7853283031776333`*^9, {
   3.785328362573792*^9, 3.7853283831015434`*^9}, {3.785328535040102*^9, 
   3.7853286133545313`*^9}, {3.7853286830497026`*^9, 3.785328685307771*^9}, {
   3.78532883560382*^9, 3.785328912449293*^9}, {3.7853290277243176`*^9, 
   3.7853290585884676`*^9}, {3.785329164415945*^9, 3.7853292520484576`*^9}, {
   3.7853293732441*^9, 3.7853294109034595`*^9}, {3.7853296295548787`*^9, 
   3.785329635123947*^9}, {3.7853296805013227`*^9, 3.7853297144592953`*^9}, {
   3.785329991863968*^9, 3.7853300444909444`*^9}, {3.7853301855876074`*^9, 
   3.785330199686454*^9}, {3.7853302756737394`*^9, 3.785330323310184*^9}, {
   3.785330417758294*^9, 3.7853304301716213`*^9}, {3.785330557349225*^9, 
   3.7853305836878824`*^9}, {3.785330728246673*^9, 3.7853307705332394`*^9}, {
   3.785330887036869*^9, 3.7853309000477333`*^9}, {3.7853309977608075`*^9, 
   3.785331024826496*^9}, {3.7853311137745533`*^9, 3.7853311154210625`*^9}, 
   3.785331209306743*^9, 3.7853314705179157`*^9, {3.7853315252187786`*^9, 
   3.7853315382856936`*^9}, {3.7853316973106337`*^9, 
   3.7853317208778563`*^9}, {3.7853319035225134`*^9, 3.7853319147407513`*^9}, 
   3.7853320332476425`*^9, {3.785332161570615*^9, 3.7853321663950224`*^9}, {
   3.785332207251267*^9, 3.7853322100238037`*^9}, {3.785332258269786*^9, 
   3.7853322584909964`*^9}, {3.7853323235631876`*^9, 
   3.7853323274166646`*^9}, {3.7853324157767887`*^9, 3.785332432132592*^9}, {
   3.7853327817724485`*^9, 3.785332782422041*^9}, {3.785332821112319*^9, 
   3.7853328989863153`*^9}, {3.785332934801982*^9, 3.785332984301107*^9}, {
   3.7853331086675053`*^9, 3.7853331129844418`*^9}, 3.7853332698485327`*^9, {
   3.7853333077220755`*^9, 3.7853333581981*^9}, {3.7853334230351543`*^9, 
   3.7853334266254277`*^9}, 3.7853335413330097`*^9, {3.785334102701851*^9, 
   3.7853341275445127`*^9}, {3.7853341820392017`*^9, 
   3.7853341897362103`*^9}, {3.785334266373089*^9, 3.7853343003010335`*^9}, {
   3.7853343806082582`*^9, 3.7853345353463507`*^9}, {3.7853345705792475`*^9, 
   3.7853345719244547`*^9}, {3.785334636985751*^9, 3.7853346647840977`*^9}, {
   3.785334737849719*^9, 3.7853347432176137`*^9}, {3.7853347872477703`*^9, 
   3.785334810917343*^9}, {3.785335008926095*^9, 3.7853350154279575`*^9}, {
   3.7853350832081213`*^9, 3.7853352619882402`*^9}, {3.785335333113305*^9, 
   3.7853353541632185`*^9}, {3.785335509578869*^9, 3.785335561752442*^9}, {
   3.7853357114398274`*^9, 3.785335741364721*^9}, {3.7853358196240644`*^9, 
   3.7853358228740373`*^9}, {3.785335941914486*^9, 3.7853359726144786`*^9}, 
   3.785336247299062*^9, {3.7853364134064593`*^9, 3.78533643798155*^9}, {
   3.785336536256124*^9, 3.785336537488248*^9}, {3.785336583880412*^9, 
   3.7853365968611064`*^9}, 3.785336634123584*^9, {3.785336864678496*^9, 
   3.78533690451289*^9}, {3.7853383685382347`*^9, 3.785338407449277*^9}, {
   3.7853408493587456`*^9, 3.7853408686302195`*^9}, 3.7853409930717025`*^9, {
   3.785341082914631*^9, 3.7853410918017254`*^9}, {3.785342278696756*^9, 
   3.7853423452414327`*^9}, {3.785347430060142*^9, 3.7853474368213043`*^9}, {
   3.785347614340805*^9, 3.7853476182633834`*^9}, 3.7853478385792685`*^9, {
   3.7853480273163605`*^9, 3.7853480404483347`*^9}, {3.7853481819974003`*^9, 
   3.7853481897824993`*^9}, {3.7853483033520527`*^9, 
   3.7853483153519945`*^9}, {3.7853483791071267`*^9, 3.785348385051547*^9}, 
   3.7853484159206944`*^9, 3.7853485108252287`*^9, {3.7853485931962757`*^9, 
   3.7853485952421412`*^9}, 3.7853486266728086`*^9, {3.7853487073123274`*^9, 
   3.7853487302622623`*^9}, {3.7853487964425178`*^9, 
   3.7853488100458307`*^9}, {3.7853488841373997`*^9, 3.785348983403922*^9}, {
   3.7853491064130898`*^9, 3.785349127239071*^9}, {3.785349186961522*^9, 
   3.785349195906669*^9}, {3.785349252283062*^9, 3.785349331266079*^9}, {
   3.7853493922359524`*^9, 3.785349457664527*^9}, {3.785349516022738*^9, 
   3.78534952170592*^9}, {3.7853496681496124`*^9, 3.7853497123957987`*^9}, {
   3.785349820582843*^9, 3.7853498316439795`*^9}, {3.78534992764303*^9, 
   3.7853499409878497`*^9}, {3.7853500321355257`*^9, 
   3.7853500410558023`*^9}, {3.7853501009378858`*^9, 3.785350159121992*^9}, {
   3.7853502768498845`*^9, 3.785350287285555*^9}, {3.7853507578154807`*^9, 
   3.7853507608922772`*^9}, {3.7853518040834665`*^9, 3.785351825252778*^9}, {
   3.785352596954365*^9, 3.7853526026335425`*^9}, {3.7853527121661987`*^9, 
   3.7853527126236076`*^9}, 3.785352753283705*^9, {3.7853531487509427`*^9, 
   3.7853531602093906`*^9}, {3.78535329107873*^9, 3.7853533039284377`*^9}, {
   3.785353445889187*^9, 3.7853534464677143`*^9}, {3.785353748022107*^9, 
   3.7853537486747108`*^9}, {3.785353862075714*^9, 3.7853538680701885`*^9}, {
   3.7853539769414196`*^9, 3.7853539818228397`*^9}, {3.78535413052871*^9, 
   3.7853541445160093`*^9}, {3.7853620906133223`*^9, 3.785362090846535*^9}, {
   3.7853650980764723`*^9, 3.7853651116298356`*^9}, {3.7853651904711185`*^9, 
   3.7853651906112366`*^9}, {3.7854190455445843`*^9, 
   3.7854191452036476`*^9}, {3.7854192059319134`*^9, 3.785419207013073*^9}, {
   3.7854192880889826`*^9, 3.785419294431774*^9}, {3.7854194447277856`*^9, 
   3.7854194528872347`*^9}, {3.78541968246652*^9, 3.7854196834364047`*^9}},
 CellLabel->"In[20]:=",ExpressionUUID->"e4436f2c-74a0-4a7a-b9e7-735e3c98e165"],

Cell[BoxData[
 RowBox[{"story", "[", "]"}]], "Input",
 CellChangeTimes->{{3.7853230637837048`*^9, 3.785323064234098*^9}, {
   3.7853231577928276`*^9, 3.7853231601709957`*^9}, 3.7853286903443713`*^9, {
   3.7853304424237933`*^9, 3.785330443632887*^9}, 3.7853315469215665`*^9, {
   3.7853378837642365`*^9, 3.7853378839674096`*^9}, {3.785347575419318*^9, 
   3.7853475968568635`*^9}, {3.7854193423884945`*^9, 3.7854193435255327`*^9}},
 CellLabel->"In[21]:=",ExpressionUUID->"73a434ce-758e-4fbe-9b12-2bad9c268b31"]
},
Evaluator->"B",
WindowSize->{1233, 1041},
WindowMargins->{{150, Automatic}, {341, Automatic}},
CellContext->Notebook,
FrontEndVersion->"12.0 for Microsoft Windows (64-bit) (April 11, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[561, 20, 1949, 40, 67, "Input",ExpressionUUID->"2d8c86ab-de9a-468f-bffa-b291648a3f0b"],
Cell[2513, 62, 12424, 218, 428, "Input",ExpressionUUID->"e4436f2c-74a0-4a7a-b9e7-735e3c98e165"],
Cell[14940, 282, 510, 7, 61, "Input",ExpressionUUID->"73a434ce-758e-4fbe-9b12-2bad9c268b31"]
}
]
*)

